#!/bin/bash

set -euo pipefail
cd "$(dirname "$0")"

install -v /dev/stdin /etc/systemd/system/borg-backup.service <<-EOF
	[Service]
	Type=oneshot
	ExecStart=$PWD/borg_backup
EOF

install -v /dev/stdin /etc/systemd/system/borg-backup.timer <<-EOF
	[Timer]
	OnCalendar=daily
	RandomizedDelaySec=4h

	[Install]
	WantedBy=timers.target
EOF

systemctl daemon-reload
systemctl enable borg-backup.timer
systemctl restart borg-backup.timer
systemctl status borg-backup.timer
